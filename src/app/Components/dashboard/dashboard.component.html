<div class="container-form">
  <h2>{{ 'sustainabilityIndicatorsCharts' | translate }}</h2>
  <div class='filtroGraficas'>
    <form
      *ngIf="energyGraphForm"
      [formGroup]="energyGraphForm"
      (ngSubmit)="loadgraphDataEnergy()">
      <div class='fields-container'>

        <mat-form-field [style.width.px]=220 class="item1">
          <mat-label>{{'delegation' | translate}}</mat-label>
          <mat-select [formControl]="delegation" panelClass="panel-{{delegation.value}}" (selectionChange)="changSelectOption($event)">
            <mat-option *ngFor="let delegation of delegations" [value]="delegation.name">
              {{delegation.name}}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="delegation.hasError('required')">{{'delegation' | translate}} <strong>{{'isRequired' | translate}}</strong></mat-error>
        </mat-form-field>

        <mat-form-field [style.width.px]=220 class="item0">
          <mat-label>{{'year' | translate}}</mat-label>
          <mat-select [formControl]="yearEnergy" (selectionChange)="changSelectOption($event)">
            <mat-option value="2019">2019</mat-option>
            <mat-option value="2020">2020</mat-option>
            <mat-option value="2021">2021</mat-option>
            <mat-option value="2022">2022</mat-option>
            <mat-option value="2023">2023</mat-option>
            <mat-option value="2024">2024</mat-option>
            <mat-option value="2025">2025</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field [style.width.px]=220 class="item2">
          <mat-label>{{'energies' | translate}}</mat-label>
            <mat-select [formControl]="energy" (selectionChange)="selectionEnergyResidueChange($event)">
              <mat-option *ngFor="let energy of energies" [value]="energy.nameES" class="small-data">
                {{energy.nameES}}
              </mat-option>
            </mat-select>
          <mat-error *ngIf="energy.hasError('required')">{{'energyType' | translate}} <strong>{{'isRequired' | translate}}</strong></mat-error>
        </mat-form-field>

        <mat-slide-toggle [(ngModel)]="isRatioBillingE" [formControl]="ratioBillingGraphE" class="item3" (change)="chartRatioBilling()">Ratio billing</mat-slide-toggle>
        <mat-slide-toggle [(ngModel)]="isRatioCNAEE" [formControl]="ratioCNAEgGraphE" class="item4" (change)="chartRatioCNAE()">Ratio CNAE</mat-slide-toggle>

        <mat-slide-toggle [(ngModel)]="isYearViewE" [formControl]="yearWiewGraphE" class="item5" (change)="chartYearlyViewE()">Year</mat-slide-toggle>
        <mat-slide-toggle [(ngModel)]="isQuarterlyViewE" [formControl]="quarterlyViewGraphE" class="item6" (change)="chartQuarterlyViewE()">Quarterly</mat-slide-toggle>
        <mat-slide-toggle [(ngModel)]="isMonthlyViewE" [formControl]="monthlyViewGraphE" class="item7" (change)="chartmonthlyViewE()">Monthly</mat-slide-toggle>

        <mat-slide-toggle [(ngModel)]="isKWViewE" [formControl]="monthlyViewGraphE" class="item8" (change)="chartmonthlyViewE()">kWh</mat-slide-toggle>
        <mat-slide-toggle [(ngModel)]="isMWViewE" [formControl]="monthlyViewGraphE" class="item9" (change)="chartmonthlyViewE()">MWh</mat-slide-toggle>

        <mat-button-toggle-group name="buttonsform" aria-label="buttons form reset and submit" class="item10">
          <button mat-raised-button color="accent" (click)="graphFormReset()">Reset</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="!energyGraphForm.valid">Graph</button>
        </mat-button-toggle-group>
      </div>
    </form>
  </div>

  <canvas id="energyGraph" aria-label= "Energy graph" role="chart"
    (Click)="onChartClick($event)">{{ chart }}</canvas>

  <div class='filtroGraficas'>
    <form
      *ngIf="waterGraphForm"
      [formGroup]="waterGraphForm"
      (ngSubmit)="loadgraphDataEnergy()">
      <div class='fields-container'>

        <mat-form-field [style.width.px]=220 class="item1">
          <mat-label>{{'delegation' | translate}}</mat-label>
          <mat-select [formControl]="delegation" panelClass="panel-{{delegation.value}}" (selectionChange)="changSelectOption($event)">
            <mat-option *ngFor="let delegation of delegations" [value]="delegation.name">
              {{delegation.name}}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="delegation.hasError('required')">{{'delegation' | translate}} <strong>{{'isRequired' | translate}}</strong></mat-error>
        </mat-form-field>

<!--         <mat-form-field [style.width.px]=220 class="item2">
          <mat-label>{{'aspect' | translate}}</mat-label>
          <mat-select [formControl]="aspect" (selectionChange)="changeAspect($event)">
            <mat-option value="1">{{aspectEnergy}}</mat-option>
            <mat-option value="2">{{aspectWater}}</mat-option>
            <mat-option value="3">{{aspectResidue}}</mat-option>
            <mat-option value="5">{{aspectEmissions}}</mat-option>
          </mat-select>
        </mat-form-field> -->

        <mat-form-field [style.width.px]=220 *ngIf="isEnergy" class="item3">
          <mat-label>{{'energies' | translate}}</mat-label>
            <mat-select [formControl]="energy" (selectionChange)="selectionEnergyResidueChange($event)">
              <mat-option *ngFor="let energy of energies" [value]="energy.nameES" class="small-data">
                {{energy.nameES}}
              </mat-option>
            </mat-select>
          <mat-error *ngIf="energy.hasError('required')">{{'energyType' | translate}} <strong>{{'isRequired' | translate}}</strong></mat-error>
        </mat-form-field>

        <mat-form-field [style.width.px]=425 *ngIf="isResidue" class="item4">
          <mat-label>{{'residueType' | translate}}</mat-label>
          <mat-select [formControl]="residue" (selectionChange)="selectionEnergyResidueChange($event)">
            <mat-option>
              <ngx-mat-select-search
              [formControl]="residueFilter"
              placeholderLabel="{{'searchResidue' | translate}}"
              noEntriesFoundLabel = "no matching residue found!"
              [clearSearchInput] = false
              [searching] = "isSearching"
              >
              <mat-icon ngxMatSelectSearchClear><i class="fa-solid fa-delete-left"></i></mat-icon>
            </ngx-mat-select-search>
            </mat-option>
                <mat-option *ngFor="let items of residuesItemCompany" [value]="items.chapterItemId" class="small-data">
                  {{items.chapterItemId}} - <strong>{{items.chapterItemName}}</strong>
                </mat-option>
          </mat-select>
          <mat-error *ngIf="residue.hasError('required')">{{'residueType' | translate}} <strong>{{'isRequired' | translate}}</strong></mat-error>
        </mat-form-field>

        <mat-button-toggle-group name="buttonsform" aria-label="buttons form reset and submit" class="item5">
          <button mat-raised-button color="accent" (click)="graphFormReset()">Reset</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="!waterGraphForm.valid">Graph</button>
        </mat-button-toggle-group>
        <mat-slide-toggle [(ngModel)]="isRatioBillingE" [formControl]="ratioBillingGraphE" class="item6" (change)="chartRatioBilling()">Ratio billing graph</mat-slide-toggle>
        <mat-slide-toggle [(ngModel)]="isRatioCNAEE" [formControl]="ratioCNAEgGraphE" class="item7" (change)="chartRatioCNAE()">Ratio CNAE graph</mat-slide-toggle>
        <mat-slide-toggle [(ngModel)]="isMonthlyViewE" [formControl]="monthlyViewGraphE" class="item7" (change)="chartRatioCNAE()">L</mat-slide-toggle>
        <mat-slide-toggle [(ngModel)]="isMonthlyViewE" [formControl]="monthlyViewGraphE" class="item7" (change)="chartRatioCNAE()">m3</mat-slide-toggle>


      </div>
    </form>
    <canvas id="waterGraph" aria-label= "Water graph" role="chart"
    (Click)="onChartClick($event)">{{ chart }}</canvas>
  </div>

  <div class='filtroGraficas'>
    <form *ngIf="residueGraphForm"
      [formGroup]="residueGraphForm"
      (ngSubmit)="loadgraphDataEnergy()">
      <div class='fields-container'>

        <mat-form-field [style.width.px]=220 class="item1">
          <mat-label>{{'delegation' | translate}}</mat-label>
          <mat-select [formControl]="delegation" panelClass="panel-{{delegation.value}}" (selectionChange)="changSelectOption($event)">
            <mat-option *ngFor="let delegation of delegations" [value]="delegation.name">
              {{delegation.name}}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="delegation.hasError('required')">{{'delegation' | translate}} <strong>{{'isRequired' | translate}}</strong></mat-error>
        </mat-form-field>

        <mat-form-field [style.width.px]=220 *ngIf="isEnergy" class="item3">
          <mat-label>{{'energies' | translate}}</mat-label>
            <mat-select [formControl]="energy" (selectionChange)="selectionEnergyResidueChange($event)">
              <mat-option *ngFor="let energy of energies" [value]="energy.nameES" class="small-data">
                {{energy.nameES}}
              </mat-option>
            </mat-select>
          <mat-error *ngIf="energy.hasError('required')">{{'energyType' | translate}} <strong>{{'isRequired' | translate}}</strong></mat-error>
        </mat-form-field>

        <mat-form-field [style.width.px]=425 *ngIf="isResidue" class="item4">
          <mat-label>{{'residueType' | translate}}</mat-label>
          <mat-select [formControl]="residue" (selectionChange)="selectionEnergyResidueChange($event)">
            <mat-option>
              <ngx-mat-select-search
              [formControl]="residueFilter"
              placeholderLabel="{{'searchResidue' | translate}}"
              noEntriesFoundLabel = "no matching residue found!"
              [clearSearchInput] = false
              [searching] = "isSearching"
              >
              <mat-icon ngxMatSelectSearchClear><i class="fa-solid fa-delete-left"></i></mat-icon>
            </ngx-mat-select-search>
            </mat-option>
                <mat-option *ngFor="let items of residuesItemCompany" [value]="items.chapterItemId" class="small-data">
                  {{items.chapterItemId}} - <strong>{{items.chapterItemName}}</strong>
                </mat-option>
          </mat-select>
          <mat-error *ngIf="residue.hasError('required')">{{'residueType' | translate}} <strong>{{'isRequired' | translate}}</strong></mat-error>
        </mat-form-field>

        <mat-button-toggle-group name="buttonsform" aria-label="buttons form reset and submit" class="item5">
          <button mat-raised-button color="accent" (click)="graphFormReset()">Reset</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="!residueGraphForm.valid">Graph</button>
        </mat-button-toggle-group>
        <mat-slide-toggle [(ngModel)]="isRatioBillingE" [formControl]="ratioBillingGraphE" class="item6" (change)="chartRatioBilling()">Ratio billing graph</mat-slide-toggle>
        <mat-slide-toggle [(ngModel)]="isRatioCNAEE" [formControl]="ratioCNAEgGraphE" class="item7" (change)="chartRatioCNAE()">Ratio CNAE graph</mat-slide-toggle>
        <mat-slide-toggle [(ngModel)]="isMonthlyViewE" [formControl]="monthlyViewGraphE" class="item7" (change)="chartRatioCNAE()">kg</mat-slide-toggle>
        <mat-slide-toggle [(ngModel)]="isMonthlyViewE" [formControl]="monthlyViewGraphE" class="item7" (change)="chartRatioCNAE()">T</mat-slide-toggle>
      </div>
    </form>
  </div>
  <canvas id="residueGraph" aria-label= "Residue graph" role="chart"
  (Click)="onChartClick($event)">{{ chart }}</canvas>

  <div class='filtroGraficas'>
    <form
      *ngIf="emissionGraphForm"
      [formGroup]="emissionGraphForm"
      (ngSubmit)="loadgraphDataEnergy()">
      <div class='fields-container'>

        <mat-form-field [style.width.px]=220 class="item1">
          <mat-label>{{'delegation' | translate}}</mat-label>
          <mat-select [formControl]="delegation" panelClass="panel-{{delegation.value}}" (selectionChange)="changSelectOption($event)">
            <mat-option *ngFor="let delegation of delegations" [value]="delegation.name">
              {{delegation.name}}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="delegation.hasError('required')">{{'delegation' | translate}} <strong>{{'isRequired' | translate}}</strong></mat-error>
        </mat-form-field>

<!--         <mat-form-field [style.width.px]=220 class="item2">
          <mat-label>{{'aspect' | translate}}</mat-label>
          <mat-select [formControl]="aspect" (selectionChange)="changeAspect($event)">
            <mat-option value="1">{{aspectEnergy}}</mat-option>
            <mat-option value="2">{{aspectWater}}</mat-option>
            <mat-option value="3">{{aspectResidue}}</mat-option>
            <mat-option value="5">{{aspectEmissions}}</mat-option>
          </mat-select>
        </mat-form-field> -->

        <mat-form-field [style.width.px]=220 *ngIf="isEnergy" class="item3">
          <mat-label>{{'energies' | translate}}</mat-label>
            <mat-select [formControl]="energy" (selectionChange)="selectionEnergyResidueChange($event)">
              <mat-option *ngFor="let energy of energies" [value]="energy.nameES" class="small-data">
                {{energy.nameES}}
              </mat-option>
            </mat-select>
          <mat-error *ngIf="energy.hasError('required')">{{'energyType' | translate}} <strong>{{'isRequired' | translate}}</strong></mat-error>
        </mat-form-field>

        <mat-form-field [style.width.px]=425 *ngIf="isResidue" class="item4">
          <mat-label>{{'residueType' | translate}}</mat-label>
          <mat-select [formControl]="residue" (selectionChange)="selectionEnergyResidueChange($event)">
            <mat-option>
              <ngx-mat-select-search
              [formControl]="residueFilter"
              placeholderLabel="{{'searchResidue' | translate}}"
              noEntriesFoundLabel = "no matching residue found!"
              [clearSearchInput] = false
              [searching] = "isSearching"
              >
              <mat-icon ngxMatSelectSearchClear><i class="fa-solid fa-delete-left"></i></mat-icon>
            </ngx-mat-select-search>
            </mat-option>
                <mat-option *ngFor="let items of residuesItemCompany" [value]="items.chapterItemId" class="small-data">
                  {{items.chapterItemId}} - <strong>{{items.chapterItemName}}</strong>
                </mat-option>
          </mat-select>
          <mat-error *ngIf="residue.hasError('required')">{{'residueType' | translate}} <strong>{{'isRequired' | translate}}</strong></mat-error>
        </mat-form-field>

        <mat-button-toggle-group name="buttonsform" aria-label="buttons form reset and submit" class="item5">
          <button mat-raised-button color="accent" (click)="graphFormReset()">Reset</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="!emissionGraphForm.valid">Graph</button>
        </mat-button-toggle-group>
        <mat-slide-toggle [(ngModel)]="isRatioBillingE" [formControl]="ratioBillingGraphE" class="item6" (change)="chartRatioBilling()">Ratio billing graph</mat-slide-toggle>
        <mat-slide-toggle [(ngModel)]="isRatioCNAEE" [formControl]="ratioCNAEgGraphE" class="item7" (change)="chartRatioCNAE()">Ratio CNAE graph</mat-slide-toggle>
        <mat-slide-toggle [(ngModel)]="isMonthlyViewE" [formControl]="monthlyViewGraphE" class="item7" (change)="chartRatioCNAE()">kg</mat-slide-toggle>
        <mat-slide-toggle [(ngModel)]="isMonthlyViewE" [formControl]="monthlyViewGraphE" class="item7" (change)="chartRatioCNAE()">T</mat-slide-toggle>

      </div>
    </form>
    <canvas id="emssionGraph" aria-label= "Emissions graph" role="chart"
    (Click)="onChartClick($event)">{{ chart }}</canvas>
  </div>

  <div class="loader" *ngIf="!consumptions">No data loaded yet...</div>
</div>
